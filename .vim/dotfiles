function! PromptForManualChange()
  echom "You changed a dotfile."
  echom "Please commit your changes to the repo until automagicness works"
endfunction

function! HandleDotfilesChange()
  " TODO
  call PromptForManualChange()
endfunction

function! ShouldUpdateDotfiles()
  if empty(glob('~/.vim/bundle/update.log'))
    return 1
  end
  return system('echo $(($(date +%s)-$(cat ~/.dotfiles/update.log)))') > 86400
endfunction

function UpdateDotfiles()
  silent exec '!cd ~/.dotfiles && git pull origin master && git rev-parse HEAD > ~/.dotfiles/head.log'
  silent exec '!date +\%s > ~/.dotfiles/update.log'
  source ~/.vimrc
endfunction

autocmd! bufwritepost ~/.dotfiles/* call HandleDotfilesChange()
autocmd! bufwritepost ~/.vimrc call HandleDotfilesChange()

if ShouldUpdateDotfiles()
  call UpdateDotfiles()
endif
